PREFIX rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#>
PREFIX owl: <http://www.w3.org/2002/07/owl#>
PREFIX rdfs: <http://www.w3.org/2000/01/rdf-schema#>
PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>
PREFIX music: <http://www.semanticweb.org/musical-instruments#>
PREFIX foaf: <http://xmlns.com/foaf/0.1/>

SELECT DISTINCT ?casaProd ?descrizione ?nome ?immagine ?dataFond ?origine ?nomecitta (group_concat(distinct ?prod;separator=", ") AS ?produce) where {
  	?casaProd rdf:type music:CasaProduttrice .
    ?casaProd rdfs:comment ?descrizione .
    ?casaProd music:NomeCasaProduttrice ?nome .
    ?casaProd music:Immagine ?immagine .
    ?casaProd music:FondataNel ?dataFond .
    ?casaProd music:ubicataIn ?citta .
    ?citta music:NomeCitta ?nomecitta .
    ?citta rdf:type ?origineTipo .
    FILTER(?origineTipo IN (music:CittaAmericana, music:CittaGiapponese))
    ?origineTipo rdfs:label ?origine .
    optional {
        ?casaProd music:produce ?strumento .
        ?strumento music:NomeStrumentoMusicale ?prod
    }
    optional {
        ?casaProd music:producePezzi ?strumento .
        ?strumento music:NomeStrumentoMusicale ?prod
    }
}
GROUP BY ?casaProd ?descrizione ?nome ?immagine ?dataFond ?origine ?nomecitta